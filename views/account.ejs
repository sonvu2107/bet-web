<!DOCTYPE html>
<html>
<head>
    <title>Thông tin tài khoản</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
<div class="container">
    <h2>Thông tin tài khoản</h2>
    <ul>
        <li><b>Tài khoản:</b> <%= user.username %></li>
        <li><b>Điểm hiện có:</b> <%= user.score %></li>
        <li><b>Level:</b> <%= level %></li>
        <li><b>Tổng số lần cược:</b> <%= totalBets %></li>
        <li><b>Tỉ lệ thắng:</b> <%= winRate %>%</li>
    </ul>

    <h3>Thông tin cấp độ & mốc thưởng</h3>
    <table>
        <thead>
            <tr>
                <th>Level</th>
                <th>Số trận thắng cần</th>
                <th>Thưởng khi đạt</th>
            </tr>
        </thead>
        <tbody>
        <% milestones.forEach(m => { %>
            <tr <% if ((user.level || 1) === m.level) { %> style="font-weight:bold; color:#007bff" <% } %>>
                <td><%= m.level %></td>
                <td><%= m.require %></td>
                <td>+<%= m.reward %> điểm</td>
            </tr>
        <% }) %>
        </tbody>
    </table>

    <h3>Biểu đồ điểm theo thời gian</h3>
    <canvas id="scoreChart" width="400" height="200"></canvas>

    <p><a class="btn return-home" href="/">Quay về trang chủ</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const history = <%- JSON.stringify(history || []) %>;
  const labels = history.map(h => {
    const d = new Date(h.time);
    return d.toLocaleString();
  });
  const data = history.map(h => h.score);
  const ctx = document.getElementById('scoreChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Điểm',
        data: data,
        borderColor: '#3f51b5',
        backgroundColor: 'rgba(63,81,181,0.1)',
        fill: true,
        tension: 0.2
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { display: true, title: { display: true, text: 'Thời gian' } },
        y: { display: true, title: { display: true, text: 'Điểm' } }
      }
    }
  });
</script>
</body>
</html>
